//this is the adventure game rendered
// create the game instance
// window.currentWorld = mapData;
var game = new RL.Game();
var mapData = [
    "#########################################################################################",
    "#.........#..........#................................................................#.#",
    "#u........#....##....#................................................................#.#",
    "#k........+....##....#................................................................#.#",
    "#p........#..........+................................................................#.#",
    "#n#..#..#.#..........#................................................................#.#",
    "#.........#...####+#+#................................................................#.#",
    "#.........#...#......#................................................................#.#",
    "#.........#...#......#................................................................#.#",
    "#.........#...#......#..................................................................#",
    "#.........#...#......#..................................................................#",
    "#.........#...#......#..................................................................#",
    "#.........#...#......#..................................................................#",
    "#.........#...#......#..................................................................#",
    "#.........#...#......#..................................................................1",
    "#########################################################################################"
    ];
// window.currentWorld = mapData;
var mapDataLevel2 = [
    "#########################################################################",
    "#...#..............2#...............#...........#...................#...#",
    "#...#...#########...#...#####...#########...#####...#####...#####...#...#",
    "#...............#.......#...#...........#...........#...#...#.......#...#",
    "#.......#...#...#########...#########...#####...#...#...#...#########...#",
    "#.......#...#...............#...........#...#...#...#...#...........#...#",
    "#####################...#...#...#########...#####...#...#########...#...#",
    "#...................#...#...#.......#...........#...........#.......#...#",
    "#...#############...#####...#####...#...#####...#########...#...#####...#",
    "#...........#.......#...#.......#...#.......#...........#...#...........#",
    "#...#####...#####...#...#####...#...#########...#...#...#...#############",
    "#.......#.......#...#...#.......#.......#.......#...#...#.......#.......#",
    "#############...#...#...#...#########...#...#####...#...#####...#####...#",
    "#...........#...#...........#.......#...#.......#...#.......#...........#",
    "#...#####...#...#########...#####...#...#####...#####...#############...#",
    "#...#.......#...........#...........#.......#...#...#...............#...#",
    "#...#...#########...#...#####...#########...#...#...#############...#...#",
    "#...#...........#...#...#...#...#...........#...............#...#.......#",
    "#...#########...#...#...#...#####...#########...#########...#...#########",
    "#...#.......#...#...#...........#...........#...#.......#...............#",
    "#...#...#####...#####...#####...#########...#####...#...#########...#...#",
    "#...#...................#...........#...............#...............#...#",
    "#########################################################################"
    ];

var mapDataLevel3 = [
    "#######################################################################################################3#",
    "#......................#.................#......#.................#.........................#.........#.#",
    "#..##################..#.#########.#.#.###.#....#.###...###########.#.######.##############.#.#######.#.#",
    "#..#................#..#.....#...#.#.#.....########.###.............#........#............#.#.#.......#.#",
    "#..#..############..#..#####.#.#.#.#.#####..........#.#.##.#################.######.#####.#.#.#.#######.#",
    "#..#..#.............#..#...#.#.#.#.#.....#.######.#.#...#..#...#.#........................#..........##.#",
    "#..#..#...###########..#.#.#.#.#.###.##.##..........#.#.#.##.#.#.##############.###########.########.##.#",
    "#.....#................#.#...#.#...#.##.#..#####.##.#.#...#..#............................#...........#.#",
    "######################...#.#.#.#.#.#.#..#.........#.#...#...#######################.############.####.#.#",
    "#..#...................#...#.#.#.#...#.########.#.#.#######.#.....................#.#............#....#.#",
    "#..#.#################...##.##.###.#.#.#....+.#.#.#.........#.#####################.#.#.#######..####.#.#",
    "#..#.#.#...#...#...#...#.##.#.####.#.#.#....#.#.#.#.###.#####.......................#.#.#.....#..#....#.#",
    "#..#.#...#...#...#...#....#.#.####.#.#.######.#.#.#.#.#.......#####################.#.#.#.#.#.#..#.####.#",
    "#..#.#.#...#...#...#...####.#......#.#...+..#.#.....#.#.#######...................#.#.#.#.#.#.#..#....#.#",
    "#..#.#.#################.#..#####..#####.####.#####.#.#.........###################.#.#.#.#.#.#..#.####.#",
    "#..#.....................#......#........#..............#########...................#.#.#.#.#.#..#....#.#",
    "#..#.##########################.########.#.########.######........#################.#.#.#.#.#.#..##.###.#",
    "#..#.#..................................................#..######.#.................#.#.#.#.#.#...#...#.#",
    "#..#.####################.###############################.##......##############.##########.#####.###.#.#",
    "#..#....................#.................................#..####..............#..........#.....#.....#.#",
    "#..###################..#.################.############################.#############.#########.#####.#.#",
    "#.......................#................#............................................................#.#",
    "#+#####################################################################################################.#",
    "#.......................................................................................................#",
    "#########################################################################################################"
];
var mapDataLevel4 = [
    "######################################################################################",
    "#.......................#.......#.....#...z......#.....#.............................#",
    "#......#..............................#.....#....#.....#.................########....#",
    "#......#..............................#......#...#......e................#......#....#",
    "#......+.................##############.....#....#.....#.................#......#....#",
    "#......#....................................#....#...#...................#..###.#....#",
    "#......#.................##############......#..#...#....................#..#.#.#....#",
    "#......#..............................#......#......#....................#......#....#",
    "#......#....................########......#..#...#.......................#......#....#",
    "#......#...........................#..#......#..#...######################......#....#",
    "#......#...........................#.........#..#................................#...#",
    "#......#...........................#..#......#..##########################........#..#",
    "#......#...........................#..#......#....................................#..#",
    "######################################################################################",
];

// var mapDataLevel5 = [
//     "#########################################################################################",
//     "##############..................................#..........#......#.....................#",
//     "#............#.................############.....#..........#......#.....................#",
//     "###########..###+###...........#...........##....####+######......###+###################",
//     "#.........#..#.....#...........#.............#....#......................#..............#",
//     "###########..##############....#..............#....#.....................#..............#",
//     "#............#............#....#...............#....#...................................#",
//     "#...##########............#....#................#....#############.......#..............#",
//     "#...#.....................#....#.................................#.......#..............#",
//     "#...#....#####............#....########################..........#.......#..............#",
//     "#...#....#................#...........................#..........#.......#..............#",
//     "#...#....#######..........#...........................#..........#.......#..............#",
//     "#...#..........#..........#########################...#..........#.......#..............#",
//     "#...#########..#..........#...........................#..........#.......#..............#",
//     "#..............#..........+...........................#..................#..............#",
//     "#########################################################################################"
//     ];

// Tile types
var mapCharToType = {
  '#': 'wall',
  '.': 'grass',
  '+': 'door',
  '-': 'door-open',
  '1': 'exitDoorLevel1',
  '2': 'exitDoorLevel2',
  '3': 'exitDoorLevel3'
};

var entityCharToType = {
  'e': 'slime',
  'Z': 'owl',
  'b': 'bird',
  'n': 'ninja',
  'k': 'knight',
  'p': 'pirate',
  'u': 'pikachu'
};

var itemCharToType = {
  ':': 'potion'
};

var keyBindings = {
  up: ['UP_ARROW', 'K', 'W'],
  down: ['DOWN_ARROW', 'J', 'S'],
  left: ['LEFT_ARROW', 'H', 'A'],
  right: ['RIGHT_ARROW', 'L', 'D'],
};

// function enemyGenerator(map, enemyNumber) {
//   var arr = ['e', 'Z', 'b'];
//   var xLength = map[0].length - 2;
//   var yLength = map.length - 2;

//   var enemyReplacer = function(mapLine, enemy, randX) {
//     mapLine = mapLine.substring(0, randX) + enemy + mapLine.substring(randX + 1);
//     return mapLine;
//   }

//   while(enemyNumber > 0) {
//     var randX = Math.floor((Math.random() * xLength) + 1);
//     var randY = Math.floor((Math.random() * yLength) + 1);

//     if(map[randY][randX] === '.') {
//       var randEnemy = arr[Math.floor(Math.random() * 3)];
//       map[randY] = enemyReplacer(map[randY], randEnemy, randX);
//       enemyNumber--;
//     }
//   }
// }

// function itemGenerator(map, itemNumber) {
//   var xLength = map[0].length - 2;
//   var yLength = map.length - 2;

//   var itemReplacer = function(mapLine, item, randX) {
//     mapLine = mapLine.substring(0, randX) + item + mapLine.substring(randX + 1);
//     return mapLine;
//   }

//   while(itemNumber > 0) {
//     var randX = Math.floor((Math.random() * xLength) + 1);
//     var randY = Math.floor((Math.random() * yLength) + 1);

//     if(map[randY][randX] === '.') {
//       var item = ':';
//       map[randY] = itemReplacer(map[randY], item, randX);
//       itemNumber--;
//     }
//   }
// }
game.itemGenerator = function(map, itemNumber) {
  var xLength = map[0].length - 2;
  var yLength = map.length - 2;

  var itemReplacer = function(mapLine, item, randX) {
    mapLine = mapLine.substring(0, randX) + item + mapLine.substring(randX + 1);
    return mapLine;
  }

  while(itemNumber > 0) {
    var randX = Math.floor((Math.random() * xLength) + 1);
    var randY = Math.floor((Math.random() * yLength) + 1);

    if(map[randY][randX] === '.') {
      var item = ':';
      map[randY] = itemReplacer(map[randY], item, randX);
      itemNumber--;
    }
  }
};

game.enemyGenerator = function(map, enemyNumber) {
  var arr = ['e', 'Z', 'b'];
  var xLength = map[0].length - 2;
  var yLength = map.length - 2;

  var enemyReplacer = function(mapLine, enemy, randX) {
    mapLine = mapLine.substring(0, randX) + enemy + mapLine.substring(randX + 1);
    return mapLine;
  }

  while(enemyNumber > 0) {
    var randX = Math.floor((Math.random() * xLength) + 1);
    var randY = Math.floor((Math.random() * yLength) + 1);

    if(map[randY][randX] === '.') {
      var randEnemy = arr[Math.floor(Math.random() * 3)];
      map[randY] = enemyReplacer(map[randY], randEnemy, randX);
      enemyNumber--;
    }
  }
};

game.itemGenerator(mapData, 4);
game.enemyGenerator(mapData, 21);
// enemyGenerator(mapData, 28);
// itemGenerator(mapData, 5);
game.map.loadTilesFromArrayString(mapData, mapCharToType, 'grass');
game.itemManager.loadFromArrayString(mapData, itemCharToType);
game.entityManager.loadFromArrayString(mapData, entityCharToType);

//game.map.loadTilesFromArrayString(maplevel2,mapchartotype, 'grass')
// generate and assign a map object (replaces empty default)
game.setMapSize(game.map.width, game.map.height);

// add input keybindings
game.input.addBindings(keyBindings);

// set player starting position
game.player.x = 3;
game.player.y = 3;

// make the view a little smaller (10x10 characters)
game.renderer.resize(10, 10);

// get existing DOM elements
var mapContainerEl = document.getElementById('roguelike-map-container');
var consoleContainerEl = document.getElementById('roguelike-console-container');

// append elements created by the game to the DOM
mapContainerEl.appendChild(game.renderer.canvas);
consoleContainerEl.appendChild(game.console.el);

game.renderer.layers = [
  new RL.RendererLayer(game, 'map',       {draw: false,   mergeWithPrevLayer: false}),
  new RL.RendererLayer(game, 'item',      {draw: false,   mergeWithPrevLayer: true}),
  new RL.RendererLayer(game, 'entity',    {draw: false,   mergeWithPrevLayer: true}),
  new RL.RendererLayer(game, 'lighting',  {draw: true,    mergeWithPrevLayer: false}),
  new RL.RendererLayer(game, 'fov',       {draw: true,    mergeWithPrevLayer: false})
];
